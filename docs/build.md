

## Build

Important points about webpack configuration

### production

#### CI

The `ForkTsCheckerWebpackPlugin` `async` is false so that build process returns non-zero code if the typescript type check fails;
useful for continuous integration.
```
new ForkTsCheckerWebpackPlugin({
      async: false,
      watch: localPath('src'),
      tslint: true,
    })
```

### browser extension

#### Development: We cannot use optimization.splitChunks

Although webpack 4 provides excellent `optimization.splitChunks` option, it cannot be enabled for extension development.
Chunks generated by the `splitChunks` communicate through the shared `window` variable.

However, each browser content script lives in a sandbox (see [here](https://developer.chrome.com/extensions/content_scripts));
it can access `window` variable but most probably each such window instance is just a clone of the DOM window.
The only real way content scripts can interact is through the actual DOM (or a kind fo WEB API messages).

The manual division into two entry points is decent but surely there is room for improvement.


#### Development: Static file loading

If a content script CSS tries to load a static file, the the URL is interpreted relative to the tab URL,
not the browser extension URL (so we end up with e.g. `stackoverflow.com/assets/extension_icon.png` instead of
`chrome-extension://XYZ/assets/extension_icon.png`.
Some solutions have been proposed [here](https://stackoverflow.com/questions/3958617/google-chrome-extension-relative-path).
However, they make the code inflexible --
they cannot be used in a simple client app anymore, as existence of chrome browser extension is assumed.


###### our solution
We manually set the browser extension key
(more [here](https://stackoverflow.com/questions/40134044/webpack-2-x-does-webpack-public-path-still-work)),
so we know the app key at runtime and can explicitly define the address where static files should be searched for:

 `publicPath:` `chrome-extension://${KEY}/`

 (where we ourselves have devised the `KEY`)

###### production

The production key is provided by Chrome on app registration.
